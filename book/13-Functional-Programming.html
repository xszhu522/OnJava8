<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://xszhu522.github.io/OnJava8/book/13-Functional-Programming.html"><meta property="og:site_name" content="On Java 8"><meta property="og:title" content="第十三章 函数式编程"><meta property="og:description" content="[TOC] 函数式编程语言操纵代码片段就像操作数据一样容易。 虽然 Java 不是函数式语言，但 Java 8 Lambda 表达式和方法引用 (Method References) 允许你以函数式编程。 在计算机时代早期，内存是稀缺和昂贵的。几乎每个人都用汇编语言编程。人们虽然知道编译器，但编译器生成的代码很低效，比手工编码的汇编程序多很多字节，仅仅..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2020-12-08T07:46:27.000Z"><meta property="article:author" content="xszhu522"><meta property="article:modified_time" content="2020-12-08T07:46:27.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"第十三章 函数式编程","image":[""],"dateModified":"2020-12-08T07:46:27.000Z","author":[{"@type":"Person","name":"xszhu522","url":"https://xszhu522.github.io"}]}</script><title>第十三章 函数式编程 | On Java 8</title><meta name="description" content="[TOC] 函数式编程语言操纵代码片段就像操作数据一样容易。 虽然 Java 不是函数式语言，但 Java 8 Lambda 表达式和方法引用 (Method References) 允许你以函数式编程。 在计算机时代早期，内存是稀缺和昂贵的。几乎每个人都用汇编语言编程。人们虽然知道编译器，但编译器生成的代码很低效，比手工编码的汇编程序多很多字节，仅仅...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/OnJava8/assets/style-3fb0a506.css" as="style"><link rel="stylesheet" href="/OnJava8/assets/style-3fb0a506.css">
    <link rel="modulepreload" href="/OnJava8/assets/app-f910849f.js"><link rel="modulepreload" href="/OnJava8/assets/13-Functional-Programming.html-368d74ac.js"><link rel="modulepreload" href="/OnJava8/assets/13-Functional-Programming.html-986a44dd.js"><link rel="modulepreload" href="/OnJava8/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/OnJava8/assets/index.html-9040ef01.js" as="script"><link rel="prefetch" href="/OnJava8/assets/coverpage.html-2d7c242d.js" as="script"><link rel="prefetch" href="/OnJava8/assets/00-Introduction.html-eaf49a2e.js" as="script"><link rel="prefetch" href="/OnJava8/assets/00-On-Java-8.html-a8fe88ea.js" as="script"><link rel="prefetch" href="/OnJava8/assets/00-Preface.html-33e8e601.js" as="script"><link rel="prefetch" href="/OnJava8/assets/01-What-is-an-Object.html-f37b3b40.js" as="script"><link rel="prefetch" href="/OnJava8/assets/02-Installing-Java-and-the-Book-Examples.html-c84afff7.js" as="script"><link rel="prefetch" href="/OnJava8/assets/03-Objects-Everywhere.html-beea03fa.js" as="script"><link rel="prefetch" href="/OnJava8/assets/04-Operators.html-323f3057.js" as="script"><link rel="prefetch" href="/OnJava8/assets/05-Control-Flow.html-bf18cc56.js" as="script"><link rel="prefetch" href="/OnJava8/assets/06-Housekeeping.html-e508181e.js" as="script"><link rel="prefetch" href="/OnJava8/assets/07-Implementation-Hiding.html-9af46ea9.js" as="script"><link rel="prefetch" href="/OnJava8/assets/08-Reuse.html-f97f523b.js" as="script"><link rel="prefetch" href="/OnJava8/assets/09-Polymorphism.html-41b7d772.js" as="script"><link rel="prefetch" href="/OnJava8/assets/10-Interfaces.html-afcf9254.js" as="script"><link rel="prefetch" href="/OnJava8/assets/11-Inner-Classes.html-adbf7418.js" as="script"><link rel="prefetch" href="/OnJava8/assets/12-Collections.html-dc2016be.js" as="script"><link rel="prefetch" href="/OnJava8/assets/14-Streams.html-edb0d6ae.js" as="script"><link rel="prefetch" href="/OnJava8/assets/15-Exceptions.html-162f70de.js" as="script"><link rel="prefetch" href="/OnJava8/assets/16-Validating-Your-Code.html-dff757e2.js" as="script"><link rel="prefetch" href="/OnJava8/assets/17-Files.html-838bdaa3.js" as="script"><link rel="prefetch" href="/OnJava8/assets/18-Strings.html-b6d7176a.js" as="script"><link rel="prefetch" href="/OnJava8/assets/19-Type-Information.html-1d0b2d38.js" as="script"><link rel="prefetch" href="/OnJava8/assets/20-Generics.html-e5bc5ce5.js" as="script"><link rel="prefetch" href="/OnJava8/assets/21-Arrays.html-dfd4b9c2.js" as="script"><link rel="prefetch" href="/OnJava8/assets/22-Enumerations.html-86f0e001.js" as="script"><link rel="prefetch" href="/OnJava8/assets/23-Annotations.html-0c47a09d.js" as="script"><link rel="prefetch" href="/OnJava8/assets/24-Concurrent-Programming.html-294153f0.js" as="script"><link rel="prefetch" href="/OnJava8/assets/25-Patterns.html-3d56a821.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Becoming-a-Programmer.html-cc89cd30.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Benefits-and-Costs-of-Static-Type-Checking.html-24edb6d7.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Collection-Topics.html-52d49969.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Data-Compression.html-228c62f5.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-IO-Streams.html-5d583abd.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Javadoc.html-c66f92ca.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Low-Level-Concurrency.html-7339dbfe.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-New-IO.html-c5368fa3.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Object-Serialization.html-17708ac0.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Passing-and-Returning-Objects.html-c7f2017f.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Programming-Guidelines.html-7da455c2.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Standard-IO.html-84dd3a9b.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Supplements.html-ad0c06dd.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java.html-7a78a5af.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Understanding-equals-and-hashCode.html-f96f89b9.js" as="script"><link rel="prefetch" href="/OnJava8/assets/GLOSSARY.html-601bb92d.js" as="script"><link rel="prefetch" href="/OnJava8/assets/MYWORD.html-46d53d67.js" as="script"><link rel="prefetch" href="/OnJava8/assets/index.html-63c1d859.js" as="script"><link rel="prefetch" href="/OnJava8/assets/404.html-04cd5334.js" as="script"><link rel="prefetch" href="/OnJava8/assets/index.html-6224b1d9.js" as="script"><link rel="prefetch" href="/OnJava8/assets/coverpage.html-a5f4edd0.js" as="script"><link rel="prefetch" href="/OnJava8/assets/00-Introduction.html-937176cc.js" as="script"><link rel="prefetch" href="/OnJava8/assets/00-On-Java-8.html-45ff47f3.js" as="script"><link rel="prefetch" href="/OnJava8/assets/00-Preface.html-c622168b.js" as="script"><link rel="prefetch" href="/OnJava8/assets/01-What-is-an-Object.html-258aab78.js" as="script"><link rel="prefetch" href="/OnJava8/assets/02-Installing-Java-and-the-Book-Examples.html-6c2ef8fe.js" as="script"><link rel="prefetch" href="/OnJava8/assets/03-Objects-Everywhere.html-cb22980a.js" as="script"><link rel="prefetch" href="/OnJava8/assets/04-Operators.html-45217991.js" as="script"><link rel="prefetch" href="/OnJava8/assets/05-Control-Flow.html-c874afbf.js" as="script"><link rel="prefetch" href="/OnJava8/assets/06-Housekeeping.html-972e969a.js" as="script"><link rel="prefetch" href="/OnJava8/assets/07-Implementation-Hiding.html-ec574ec5.js" as="script"><link rel="prefetch" href="/OnJava8/assets/08-Reuse.html-1c0b0e71.js" as="script"><link rel="prefetch" href="/OnJava8/assets/09-Polymorphism.html-ee1b1915.js" as="script"><link rel="prefetch" href="/OnJava8/assets/10-Interfaces.html-5f3a8bbe.js" as="script"><link rel="prefetch" href="/OnJava8/assets/11-Inner-Classes.html-2d056c94.js" as="script"><link rel="prefetch" href="/OnJava8/assets/12-Collections.html-70b65c83.js" as="script"><link rel="prefetch" href="/OnJava8/assets/14-Streams.html-6c131f04.js" as="script"><link rel="prefetch" href="/OnJava8/assets/15-Exceptions.html-632887e6.js" as="script"><link rel="prefetch" href="/OnJava8/assets/16-Validating-Your-Code.html-fc22a0a5.js" as="script"><link rel="prefetch" href="/OnJava8/assets/17-Files.html-1c0f933a.js" as="script"><link rel="prefetch" href="/OnJava8/assets/18-Strings.html-7d668196.js" as="script"><link rel="prefetch" href="/OnJava8/assets/19-Type-Information.html-68020d96.js" as="script"><link rel="prefetch" href="/OnJava8/assets/20-Generics.html-698e4347.js" as="script"><link rel="prefetch" href="/OnJava8/assets/21-Arrays.html-7cf7c7c5.js" as="script"><link rel="prefetch" href="/OnJava8/assets/22-Enumerations.html-3be9ddac.js" as="script"><link rel="prefetch" href="/OnJava8/assets/23-Annotations.html-5437a43a.js" as="script"><link rel="prefetch" href="/OnJava8/assets/24-Concurrent-Programming.html-3cd1a98f.js" as="script"><link rel="prefetch" href="/OnJava8/assets/25-Patterns.html-7b04b960.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Becoming-a-Programmer.html-5373cc90.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Benefits-and-Costs-of-Static-Type-Checking.html-394f2e11.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Collection-Topics.html-8cddbcd6.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Data-Compression.html-3b3583b3.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-IO-Streams.html-4616b021.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Javadoc.html-192b7ef3.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Low-Level-Concurrency.html-11c25911.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-New-IO.html-0b06b27e.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Object-Serialization.html-e9c2f80d.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Passing-and-Returning-Objects.html-806dc68f.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Programming-Guidelines.html-0625925c.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Standard-IO.html-b4843c59.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Supplements.html-ba97e2f3.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java.html-739640c3.js" as="script"><link rel="prefetch" href="/OnJava8/assets/Appendix-Understanding-equals-and-hashCode.html-78b8eff1.js" as="script"><link rel="prefetch" href="/OnJava8/assets/GLOSSARY.html-2e9e6137.js" as="script"><link rel="prefetch" href="/OnJava8/assets/MYWORD.html-ce242754.js" as="script"><link rel="prefetch" href="/OnJava8/assets/index.html-40036f93.js" as="script"><link rel="prefetch" href="/OnJava8/assets/404.html-e7bcc212.js" as="script"><link rel="prefetch" href="/OnJava8/assets/giscus-0b7adcf8.js" as="script"><link rel="prefetch" href="/OnJava8/assets/photoswipe.esm-1464cdb9.js" as="script"><link rel="prefetch" href="/OnJava8/assets/SearchResult-3a48235e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/OnJava8/"><img class="vp-nav-logo" src="/OnJava8/LogoMark.png" alt="On Java 8"><!----><span class="vp-site-name hide-in-pad">On Java 8</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="项目主页" class="vp-link nav-link nav-link" href="/OnJava8/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>项目主页<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="OnJava8" class="vp-link nav-link active nav-link active" href="/OnJava8/book/"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>OnJava8<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/xszhu522/OnJava8" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a aria-label="目录" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/"><!---->目录<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="译者的话" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/MYWORD.html"><!---->译者的话<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="封面" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/00-On-Java-8.html"><!---->封面<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="前言" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/00-Preface.html"><!---->前言<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="简介" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/00-Introduction.html"><!---->简介<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第一章 对象的概念" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/01-What-is-an-Object.html"><!---->第一章 对象的概念<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第二章 安装Java和本书用例" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/02-Installing-Java-and-the-Book-Examples.html"><!---->第二章 安装Java和本书用例<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第三章 万物皆对象" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/03-Objects-Everywhere.html"><!---->第三章 万物皆对象<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第四章 运算符" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/04-Operators.html"><!---->第四章 运算符<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第五章 控制流" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/05-Control-Flow.html"><!---->第五章 控制流<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第六章 初始化和清理" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/06-Housekeeping.html"><!---->第六章 初始化和清理<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第七章 封装" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/07-Implementation-Hiding.html"><!---->第七章 封装<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第八章 复用" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/08-Reuse.html"><!---->第八章 复用<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第九章 多态" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/09-Polymorphism.html"><!---->第九章 多态<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第十章 接口" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/10-Interfaces.html"><!---->第十章 接口<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第十一章 内部类" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/11-Inner-Classes.html"><!---->第十一章 内部类<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第十二章 集合" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/12-Collections.html"><!---->第十二章 集合<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第十三章 函数式编程" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/OnJava8/book/13-Functional-Programming.html"><!---->第十三章 函数式编程<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="新旧对比" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#新旧对比"><!---->新旧对比<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="Lambda表达式" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#lambda表达式"><!---->Lambda表达式<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="递归" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#递归"><!---->递归<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="方法引用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#方法引用"><!---->方法引用<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="Runnable接口" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#runnable接口"><!---->Runnable接口<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="未绑定的方法引用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#未绑定的方法引用"><!---->未绑定的方法引用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="构造函数引用" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#构造函数引用"><!---->构造函数引用<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="函数式接口" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#函数式接口"><!---->函数式接口<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="多参数函数式接口" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#多参数函数式接口"><!---->多参数函数式接口<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="缺少基本类型的函数" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#缺少基本类型的函数"><!---->缺少基本类型的函数<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="高阶函数" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#高阶函数"><!---->高阶函数<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="闭包" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#闭包"><!---->闭包<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="作为闭包的内部类" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#作为闭包的内部类"><!---->作为闭包的内部类<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="函数组合" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#函数组合"><!---->函数组合<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="柯里化和部分求值" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#柯里化和部分求值"><!---->柯里化和部分求值<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="纯函数式编程" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#纯函数式编程"><!---->纯函数式编程<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="本章小结" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/OnJava8/book/13-Functional-Programming.html#本章小结"><!---->本章小结<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a aria-label="第十四章 流式编程" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/14-Streams.html"><!---->第十四章 流式编程<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第十五章 异常" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/15-Exceptions.html"><!---->第十五章 异常<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第十六章 代码校验" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/16-Validating-Your-Code.html"><!---->第十六章 代码校验<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第十七章 文件" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/17-Files.html"><!---->第十七章 文件<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第十八章 字符串" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/18-Strings.html"><!---->第十八章 字符串<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第十九章 类型信息" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/19-Type-Information.html"><!---->第十九章 类型信息<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第二十章 泛型" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/20-Generics.html"><!---->第二十章 泛型<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第二十一章 数组" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/21-Arrays.html"><!---->第二十一章 数组<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第二十二章 枚举" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/22-Enumerations.html"><!---->第二十二章 枚举<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第二十三章 注解" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/23-Annotations.html"><!---->第二十三章 注解<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第二十四章 并发编程" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/24-Concurrent-Programming.html"><!---->第二十四章 并发编程<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="第二十五章 设计模式" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/25-Patterns.html"><!---->第二十五章 设计模式<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:成为一名程序员" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Becoming-a-Programmer.html"><!---->附录:成为一名程序员<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:静态语言类型检查" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Benefits-and-Costs-of-Static-Type-Checking.html"><!---->附录:静态语言类型检查<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:集合主题" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Collection-Topics.html"><!---->附录:集合主题<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:数据压缩" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Data-Compression.html"><!---->附录:数据压缩<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:流式IO" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-IO-Streams.html"><!---->附录:流式IO<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:文档注释" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Javadoc.html"><!---->附录:文档注释<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:并发底层原理" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Low-Level-Concurrency.html"><!---->附录:并发底层原理<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:新IO" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-New-IO.html"><!---->附录:新IO<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:对象序列化" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Object-Serialization.html"><!---->附录:对象序列化<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:对象传递和返回" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Passing-and-Returning-Objects.html"><!---->附录:对象传递和返回<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:编程指南" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Programming-Guidelines.html"><!---->附录:编程指南<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:标准IO" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Standard-IO.html"><!---->附录:标准IO<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:补充" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Supplements.html"><!---->附录:补充<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:C++和Java的优良传统" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java.html"><!---->附录:C++和Java的优良传统<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="附录:理解equals和hashCode方法" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/Appendix-Understanding-equals-and-hashCode.html"><!---->附录:理解equals和hashCode方法<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="词汇表" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/OnJava8/book/GLOSSARY.html"><!---->词汇表<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->第十三章 函数式编程</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://xszhu522.github.io" target="_blank" rel="noopener noreferrer">xszhu522</a></span><span property="author" content="xszhu522"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2019-03-30T12:31:44.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 40 分钟</span><meta property="timeRequired" content="PT40M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/OnJava8/#新旧对比">新旧对比</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/OnJava8/#lambda表达式">Lambda表达式</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/OnJava8/#递归">递归</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/OnJava8/#方法引用">方法引用</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/OnJava8/#runnable接口">Runnable接口</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/OnJava8/#未绑定的方法引用">未绑定的方法引用</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/OnJava8/#构造函数引用">构造函数引用</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/OnJava8/#函数式接口">函数式接口</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/OnJava8/#多参数函数式接口">多参数函数式接口</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/OnJava8/#缺少基本类型的函数">缺少基本类型的函数</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/OnJava8/#高阶函数">高阶函数</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/OnJava8/#闭包">闭包</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="/OnJava8/#作为闭包的内部类">作为闭包的内部类</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/OnJava8/#函数组合">函数组合</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/OnJava8/#柯里化和部分求值">柯里化和部分求值</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/OnJava8/#纯函数式编程">纯函数式编程</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="/OnJava8/#本章小结">本章小结</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><p>[TOC]</p><!-- Functional Programming --><h1 id="第十三章-函数式编程" tabindex="-1"><a class="header-anchor" href="#第十三章-函数式编程" aria-hidden="true">#</a> 第十三章 函数式编程</h1><blockquote><p>函数式编程语言操纵代码片段就像操作数据一样容易。 虽然 Java 不是函数式语言，但 Java 8 Lambda 表达式和方法引用 (Method References) 允许你以函数式编程。</p></blockquote><p>在计算机时代早期，内存是稀缺和昂贵的。几乎每个人都用汇编语言编程。人们虽然知道编译器，但编译器生成的代码很低效，比手工编码的汇编程序多很多字节，仅仅想到这一点，人们还是选择汇编语言。</p><p>通常，为了使程序能在有限的内存上运行，在程序运行时，程序员通过修改内存中的代码，使程序可以执行不同的操作，用这种方式来节省代码空间。这种技术被称为<strong>自修改代码</strong> （self-modifying code）。只要程序小到几个人就能够维护所有棘手和难懂的汇编代码，你就能让程序运行起来。</p><p>随着内存和处理器变得更便宜、更快。C 语言出现并被大多数汇编程序员认为更“高级”。人们发现使用 C 可以显著提高生产力。同时，使用 C 创建自修改代码仍然不难。</p><p>随着硬件越来越便宜，程序的规模和复杂性都在增长。这一切只是让程序工作变得困难。我们想方设法使代码更加一致和易懂。使用纯粹的自修改代码造成的结果就是：我们很难确定程序在做什么。它也难以测试：除非你想一点点测试输出，代码转换和修改等等过程？</p><p>然而，使用代码以某种方式操纵其他代码的想法也很有趣，只要能保证它更安全。从代码创建，维护和可靠性的角度来看，这个想法非常吸引人。我们不用从头开始编写大量代码，而是从易于理解、充分测试及可靠的现有小块开始，最后将它们组合在一起以创建新代码。难道这不会让我们更有效率，同时创造更健壮的代码吗？</p><p>这就是<strong>函数式编程</strong>（FP）的意义所在。通过合并现有代码来生成新功能而不是从头开始编写所有内容，我们可以更快地获得更可靠的代码。至少在某些情况下，这套理论似乎很有用。在这一过程中，函数式语言已经产生了优雅的语法，这些语法对于非函数式语言也适用。</p><p>你也可以这样想：</p><p>OO（object oriented，面向对象）是抽象数据，FP（functional programming，函数式编程）是抽象行为。</p><p>纯粹的函数式语言在安全性方面更进一步。它强加了额外的约束，即所有数据必须是不可变的：设置一次，永不改变。将值传递给函数，该函数然后生成新值但从不修改自身外部的任何东西（包括其参数或该函数范围之外的元素）。当强制执行此操作时，你知道任何错误都不是由所谓的副作用引起的，因为该函数仅创建并返回结果，而不是其他任何错误。</p><p>更好的是，“不可变对象和无副作用”范式解决了并发编程中最基本和最棘手的问题之一（当程序的某些部分同时在多个处理器上运行时）。这是可变共享状态的问题，这意味着代码的不同部分（在不同的处理器上运行）可以尝试同时修改同一块内存（谁赢了？没人知道）。如果函数永远不会修改现有值但只生成新值，则不会对内存产生争用，这是纯函数式语言的定义。 因此，经常提出纯函数式语言作为并行编程的解决方案（还有其他可行的解决方案）。</p><p>需要提醒大家的是，函数式语言背后有很多动机，这意味着描述它们可能会有些混淆。它通常取决于各种观点：为“并行编程”，“代码可靠性”和“代码创建和库复用”。<a href="%E5%8A%9F%E8%83%BD%E7%B2%98%E8%B4%B4%E5%9C%A8%E4%B8%80%E8%B5%B7%E7%9A%84%E6%96%B9%E6%B3%95%E7%9A%84%E7%A1%AE%E6%9C%89%E7%82%B9%E4%B8%8E%E4%BC%97%E4%B8%8D%E5%90%8C%EF%BC%8C%E4%BD%86%E5%AE%83%E4%BB%8D%E4%B8%8D%E5%A4%B1%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%BA%93%E3%80%82">^1</a> 关于函数式编程能高效创建更健壮的代码这一观点仍存在部分争议。虽然已有一些好的范例[^2]，但还不足以证明纯函数式语言就是解决编程问题的最佳方法。</p><p>FP 思想值得融入非 FP 语言，如 Python。Java 8 也从中吸收并支持了 FP。我们将在此章探讨。</p><!-- Old vs. New --><h2 id="新旧对比" tabindex="-1"><a class="header-anchor" href="#新旧对比" aria-hidden="true">#</a> 新旧对比</h2><p>通常，传递给方法的数据不同，结果不同。如果我们希望方法在调用时行为不同，该怎么做呢？结论是：只要能将代码传递给方法，我们就可以控制它的行为。此前，我们通过在方法中创建包含所需行为的对象，然后将该对象传递给我们想要控制的方法来完成此操作。下面我们用传统形式和 Java 8 的方法引用、Lambda 表达式分别演示。代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/Strategize.java</span>

<span class="token keyword">interface</span> <span class="token class-name">Strategy</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> <span class="token function">approach</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Soft</span> <span class="token keyword">implements</span> <span class="token class-name">Strategy</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">approach</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> msg<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;?&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Unrelated</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">twice</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> msg <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Strategize</span> <span class="token punctuation">{</span>
  <span class="token class-name">Strategy</span> strategy<span class="token punctuation">;</span>
  <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
  <span class="token class-name">Strategize</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    strategy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Soft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">communicate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>strategy<span class="token punctuation">.</span><span class="token function">approach</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">changeStrategy</span><span class="token punctuation">(</span><span class="token class-name">Strategy</span> strategy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Strategy</span><span class="token punctuation">[</span><span class="token punctuation">]</span> strategies <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token keyword">new</span> <span class="token class-name">Strategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// [2]</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">approach</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> msg<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;!&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      msg <span class="token operator">-&gt;</span> msg<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// [3]</span>
      <span class="token class-name">Unrelated</span><span class="token operator">::</span><span class="token function">twice</span> <span class="token comment">// [4]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">Strategize</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Strategize</span><span class="token punctuation">(</span><span class="token string">&quot;Hello there&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">communicate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Strategy</span> newStrategy <span class="token operator">:</span> strategies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      s<span class="token punctuation">.</span><span class="token function">changeStrategy</span><span class="token punctuation">(</span>newStrategy<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [5]</span>
      s<span class="token punctuation">.</span><span class="token function">communicate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [6]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>hello there?
HELLO THERE!
Hello
Hello there Hello there
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Strategy</strong> 接口提供了单一的 <code>approach()</code> 方法来承载函数式功能。通过创建不同的 <strong>Strategy</strong> 对象，我们可以创建不同的行为。</p><p>我们一般通过创建一个实现<strong>Strategy</strong>接口的类来实现这种行为，正如在<strong>Soft</strong>里所做的。</p><ul><li><p><strong>[1]</strong> 在 <strong>Strategize</strong> 中，你可以看到 <strong>Soft</strong> 作为默认策略，在构造函数中赋值。</p></li><li><p><strong>[2]</strong> 一种较为简洁且更加自然的方法是创建一个<strong>匿名内部类</strong>。即便如此，仍有相当数量的冗余代码。你总需要仔细观察后才会发现：“哦，我明白了，原来这里使用了匿名内部类。”</p></li><li><p><strong>[3]</strong> Java 8 的 Lambda 表达式，其参数和函数体被箭头 <code>-&gt;</code> 分隔开。箭头右侧是从 Lambda 返回的表达式。它与单独定义类和采用匿名内部类是等价的，但代码少得多。</p></li><li><p><strong>[4]</strong> Java 8 的<strong>方法引用</strong>，它以 <code>::</code> 为特征。 <code>::</code> 的左边是类或对象的名称， <code>::</code> 的右边是方法的名称，但是没有参数列表。</p></li><li><p><strong>[5]</strong> 在使用默认的 <strong>Soft</strong> 策略之后，我们逐步遍历数组中的所有 <strong>Strategy</strong>，并通过调用 <code>changeStrategy()</code> 方法将每个 <strong>Strategy</strong> 传入变量 <code>s</code> 中。</p></li><li><p><strong>[6]</strong> 现在，每次调用 <code>communicate()</code> 都会产生不同的行为，具体取决于此刻正在使用的策略<strong>代码对象</strong>。我们传递的是行为，而并不仅仅是数据。[^3]</p></li></ul><p>在 Java 8 之前，我们能够通过 <strong>[1]</strong> 和 <strong>[2]</strong> 的方式传递功能。然而，这种语法的读写非常笨拙，并且我们别无选择。方法引用和 Lambda 表达式的出现让我们可以在需要时<strong>传递功能</strong>，而不是仅在必要时才这么做。</p><!-- Lambda Expressions --><h2 id="lambda表达式" tabindex="-1"><a class="header-anchor" href="#lambda表达式" aria-hidden="true">#</a> Lambda表达式</h2><p>Lambda 表达式是使用<strong>最小可能</strong>语法编写的函数定义：</p><ol><li><p>Lambda 表达式产生函数，而不是类。 虽然在 JVM（Java Virtual Machine，Java 虚拟机）上，一切都是类，但是幕后有各种操作执行让 Lambda 看起来像函数 —— 作为程序员，你可以高兴地假装它们“就是函数”。</p></li><li><p>Lambda 语法尽可能少，这正是为了使 Lambda 易于编写和使用。</p></li></ol><p>我们在 <strong>Strategize.java</strong> 中看到了一个 Lambda 表达式，但还有其他语法变体：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/LambdaExpressions.java</span>

<span class="token keyword">interface</span> <span class="token class-name">Description</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> <span class="token function">brief</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Body</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> <span class="token function">detailed</span><span class="token punctuation">(</span><span class="token class-name">String</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Multi</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> <span class="token function">twoArg</span><span class="token punctuation">(</span><span class="token class-name">String</span> head<span class="token punctuation">,</span> <span class="token class-name">Double</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LambdaExpressions</span> <span class="token punctuation">{</span>

  <span class="token keyword">static</span> <span class="token class-name">Body</span> bod <span class="token operator">=</span> h <span class="token operator">-&gt;</span> h <span class="token operator">+</span> <span class="token string">&quot; No Parens!&quot;</span><span class="token punctuation">;</span> <span class="token comment">// [1]</span>

  <span class="token keyword">static</span> <span class="token class-name">Body</span> bod2 <span class="token operator">=</span> <span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> h <span class="token operator">+</span> <span class="token string">&quot; More details&quot;</span><span class="token punctuation">;</span> <span class="token comment">// [2]</span>

  <span class="token keyword">static</span> <span class="token class-name">Description</span> desc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;Short info&quot;</span><span class="token punctuation">;</span> <span class="token comment">// [3]</span>

  <span class="token keyword">static</span> <span class="token class-name">Multi</span> mult <span class="token operator">=</span> <span class="token punctuation">(</span>h<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> h <span class="token operator">+</span> n<span class="token punctuation">;</span> <span class="token comment">// [4]</span>

  <span class="token keyword">static</span> <span class="token class-name">Description</span> moreLines <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// [5]</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;moreLines()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;from moreLines()&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bod<span class="token punctuation">.</span><span class="token function">detailed</span><span class="token punctuation">(</span><span class="token string">&quot;Oh!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bod2<span class="token punctuation">.</span><span class="token function">detailed</span><span class="token punctuation">(</span><span class="token string">&quot;Hi!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>desc<span class="token punctuation">.</span><span class="token function">brief</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mult<span class="token punctuation">.</span><span class="token function">twoArg</span><span class="token punctuation">(</span><span class="token string">&quot;Pi! &quot;</span><span class="token punctuation">,</span> <span class="token number">3.14159</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>moreLines<span class="token punctuation">.</span><span class="token function">brief</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Oh! No Parens!
Hi! More details
Short info
Pi! 3.14159
moreLines()
from moreLines()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们从三个接口开始，每个接口都有一个单独的方法（很快就会理解它的重要性）。但是，每个方法都有不同数量的参数，以便演示 Lambda 表达式语法。</p><p>任何 Lambda 表达式的基本语法是：</p><ol><li><p>参数。</p></li><li><p>接着 <code>-&gt;</code>，可视为“产出”。</p></li><li><p><code>-&gt;</code> 之后的内容都是方法体。</p></li></ol><ul><li><p><strong>[1]</strong> 当只用一个参数，可以不需要括号 <code>()</code>。 然而，这是一个特例。</p></li><li><p><strong>[2]</strong> 正常情况使用括号 <code>()</code> 包裹参数。 为了保持一致性，也可以使用括号 <code>()</code> 包裹单个参数，虽然这种情况并不常见。</p></li><li><p><strong>[3]</strong> 如果没有参数，则必须使用括号 <code>()</code> 表示空参数列表。</p></li><li><p><strong>[4]</strong> 对于多个参数，将参数列表放在括号 <code>()</code> 中。</p></li></ul><p>到目前为止，所有 Lambda 表达式方法体都是单行。 该表达式的结果自动成为 Lambda 表达式的返回值，在此处使用 <strong>return</strong> 关键字是非法的。 这是 Lambda 表达式简化相应语法的另一种方式。</p><p><strong>[5]</strong> 如果在 Lambda 表达式中确实需要多行，则必须将这些行放在花括号中。 在这种情况下，就需要使用 <strong>return</strong>。</p><p>Lambda 表达式通常比<strong>匿名内部类</strong>产生更易读的代码，因此我们将在本书中尽可能使用它们。</p><h3 id="递归" tabindex="-1"><a class="header-anchor" href="#递归" aria-hidden="true">#</a> 递归</h3><p>递归函数是一个自我调用的函数。可以编写递归的 Lambda 表达式，但需要注意：递归方法必须是实例变量或静态变量，否则会出现编译时错误。 我们将为每个案例创建一个示例。</p><p>这两个示例都需要一个接受 <strong>int</strong> 型参数并生成 <strong>int</strong> 的接口：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/IntCall.java</span>

<span class="token keyword">interface</span> <span class="token class-name">IntCall</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>整数 n 的阶乘将所有小于或等于 n 的正整数相乘。 阶乘函数是一个常见的递归示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/RecursiveFactorial.java</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecursiveFactorial</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token class-name">IntCall</span> fact<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fact <span class="token operator">=</span> n <span class="token operator">-&gt;</span> n <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> n <span class="token operator">*</span> fact<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fact<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>1
1
2
6
24
120
720
5040
40320
362880
3628800
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里，<code>fact</code> 是一个静态变量。 注意使用三元 <strong>if-else</strong>。 递归函数将一直调用自己，直到 <code>i == 0</code>。所有递归函数都有“停止条件”，否则将无限递归并产生异常。</p><p>我们可以将 <code>Fibonacci</code> 序列用递归的 Lambda 表达式来实现，这次使用实例变量：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/RecursiveFibonacci.java</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecursiveFibonacci</span> <span class="token punctuation">{</span>
  <span class="token class-name">IntCall</span> fib<span class="token punctuation">;</span>

  <span class="token class-name">RecursiveFibonacci</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fib <span class="token operator">=</span> n <span class="token operator">-&gt;</span> n <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span>
               n <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span>
               fib<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> fib<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">int</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> fib<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">RecursiveFibonacci</span> rf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RecursiveFibonacci</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rf<span class="token punctuation">.</span><span class="token function">fibonacci</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>0
1
1
2
3
5
8
13
21
34
55
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将 <code>Fibonacci</code> 序列中的最后两个元素求和来产生下一个元素。</p><!-- method references--><h2 id="方法引用" tabindex="-1"><a class="header-anchor" href="#方法引用" aria-hidden="true">#</a> 方法引用</h2><p>Java 8 方法引用没有历史包袱。方法引用组成：类名或对象名，后面跟 <code>::</code> [^4]，然后跟方法名称。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/MethodReferences.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">Callable</span> <span class="token punctuation">{</span> <span class="token comment">// [1]</span>
  <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Describe</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// [2]</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodReferences</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// [3]</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Description</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> about<span class="token punctuation">;</span>
    <span class="token class-name">Description</span><span class="token punctuation">(</span><span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{</span> about <span class="token operator">=</span> desc<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">help</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// [4]</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>about <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Helper</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">assist</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// [5]</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Describe</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Describe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Callable</span> c <span class="token operator">=</span> d<span class="token operator">::</span><span class="token function">show</span><span class="token punctuation">;</span> <span class="token comment">// [6]</span>
    c<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;call()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [7]</span>

    c <span class="token operator">=</span> <span class="token class-name">MethodReferences</span><span class="token operator">::</span><span class="token function">hello</span><span class="token punctuation">;</span> <span class="token comment">// [8]</span>
    c<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Description</span><span class="token punctuation">(</span><span class="token string">&quot;valuable&quot;</span><span class="token punctuation">)</span><span class="token operator">::</span><span class="token function">help</span><span class="token punctuation">;</span> <span class="token comment">// [9]</span>
    c<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;information&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    c <span class="token operator">=</span> <span class="token class-name">Helper</span><span class="token operator">::</span><span class="token function">assist</span><span class="token punctuation">;</span> <span class="token comment">// [10]</span>
    c<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;Help!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>call()
Hello, Bob
valuable information
Help!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>[1]</strong> 我们从单一方法接口开始（同样，你很快就会了解到这一点的重要性）。</p><p><strong>[2]</strong> <code>show()</code> 的签名（参数类型和返回类型）符合 <strong>Callable</strong> 的 <code>call()</code> 的签名。</p><p><strong>[3]</strong> <code>hello()</code> 也符合 <code>call()</code> 的签名。</p><p><strong>[4]</strong> <code>help()</code> 也符合，它是静态内部类中的非静态方法。</p><p><strong>[5]</strong> <code>assist()</code> 是静态内部类中的静态方法。</p><p><strong>[6]</strong> 我们将 <strong>Describe</strong> 对象的方法引用赋值给 <strong>Callable</strong> ，它没有 <code>show()</code> 方法，而是 <code>call()</code> 方法。 但是，Java 似乎接受用这个看似奇怪的赋值，因为方法引用符合 <strong>Callable</strong> 的 <code>call()</code> 方法的签名。</p><p><strong>[7]</strong> 我们现在可以通过调用 <code>call()</code> 来调用 <code>show()</code>，因为 Java 将 <code>call()</code> 映射到 <code>show()</code>。</p><p><strong>[8]</strong> 这是一个<strong>静态</strong>方法引用。</p><p><strong>[9]</strong> 这是 <strong>[6]</strong> 的另一个版本：对已实例化对象的方法的引用，有时称为<em>绑定方法引用</em>。</p><p><strong>[10]</strong> 最后，获取静态内部类中静态方法的引用与 <strong>[8]</strong> 中通过外部类引用相似。</p><p>上例只是简短的介绍，我们很快就能看到方法引用的所有不同形式。</p><h3 id="runnable接口" tabindex="-1"><a class="header-anchor" href="#runnable接口" aria-hidden="true">#</a> Runnable接口</h3><p><strong>Runnable</strong> 接口自 1.0 版以来一直在 Java 中，因此不需要导入。它也符合特殊的单方法接口格式：它的方法 <code>run()</code> 不带参数，也没有返回值。因此，我们可以使用 Lambda 表达式和方法引用作为 <strong>Runnable</strong>：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/RunnableMethodReference.java</span>

<span class="token comment">// 方法引用与 Runnable 接口的结合使用</span>

<span class="token keyword">class</span> <span class="token class-name">Go</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Go::go()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunnableMethodReference</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Anonymous&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;lambda&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token class-name">Go</span><span class="token operator">::</span><span class="token function">go</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Anonymous
lambda
Go::go()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Thread</strong> 对象将 <strong>Runnable</strong> 作为其构造函数参数，并具有会调用 <code>run()</code> 的方法 <code>start()</code>。 注意这里只有<strong>匿名内部类</strong>才要求显式声明 <code>run()</code> 方法。</p><!-- Unbound Method References --><h3 id="未绑定的方法引用" tabindex="-1"><a class="header-anchor" href="#未绑定的方法引用" aria-hidden="true">#</a> 未绑定的方法引用</h3><p>未绑定的方法引用是指没有关联对象的普通（非静态）方法。 使用未绑定的引用时，我们必须先提供对象：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/UnboundMethodReference.java</span>

<span class="token comment">// 没有方法引用的对象</span>

<span class="token keyword">class</span> <span class="token class-name">X</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;X::f()&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">MakeString</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">TransformX</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">X</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnboundMethodReference</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// MakeString ms = X::f; // [1]</span>
    <span class="token class-name">TransformX</span> sp <span class="token operator">=</span> <span class="token class-name">X</span><span class="token operator">::</span><span class="token function">f</span><span class="token punctuation">;</span>
    <span class="token class-name">X</span> x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sp<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [2]</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 同等效果</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>X::f()
X::f()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>到目前为止，我们已经见过了方法引用和对应接口的签名（参数类型和返回类型）一致的几个赋值例子。 在 <strong>[1]</strong> 中，我们尝试同样的做法，把 <code>X</code> 的 <code>f()</code> 方法引用赋值给 <strong>MakeString</strong>。结果即使 <code>make()</code> 与 <code>f()</code> 具有相同的签名，编译也会报“invalid method reference”（无效方法引用）错误。 问题在于，这里其实还需要另一个隐藏参数参与：我们的老朋友 <code>this</code>。 你不能在没有 <code>X</code> 对象的前提下调用 <code>f()</code>。 因此，<code>X :: f</code> 表示未绑定的方法引用，因为它尚未“绑定”到对象。</p><p>要解决这个问题，我们需要一个 <code>X</code> 对象，因此我们的接口实际上需要一个额外的参数，正如在 <strong>TransformX</strong> 中看到的那样。 如果将 <code>X :: f</code> 赋值给 <strong>TransformX</strong>，在 Java 中是允许的。我们必须做第二个心理调整——使用未绑定的引用时，函数式方法的签名（接口中的单个方法）不再与方法引用的签名完全匹配。 原因是：你需要一个对象来调用方法。</p><p><strong>[2]</strong> 的结果有点像脑筋急转弯。我拿到未绑定的方法引用，并且调用它的<code>transform()</code>方法，将一个X类的对象传递给它，最后使得 <code>x.f()</code> 以某种方式被调用。Java知道它必须拿第一个参数，该参数实际就是<code>this</code> 对象，然后对此调用方法。</p><p>如果你的方法有更多个参数，就以第一个参数接受<code>this</code>的模式来处理。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/MultiUnbound.java</span>

<span class="token comment">// 未绑定的方法与多参数的结合运用</span>

<span class="token keyword">class</span> <span class="token class-name">This</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">two</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">three</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">,</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">four</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">,</span> <span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">TwoArgs</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">call2</span><span class="token punctuation">(</span><span class="token class-name">This</span> athis<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">ThreeArgs</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">call3</span><span class="token punctuation">(</span><span class="token class-name">This</span> athis<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">,</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">FourArgs</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">call4</span><span class="token punctuation">(</span>
    <span class="token class-name">This</span> athis<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">,</span> <span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token keyword">char</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultiUnbound</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">TwoArgs</span> twoargs <span class="token operator">=</span> <span class="token class-name">This</span><span class="token operator">::</span><span class="token function">two</span><span class="token punctuation">;</span>
    <span class="token class-name">ThreeArgs</span> threeargs <span class="token operator">=</span> <span class="token class-name">This</span><span class="token operator">::</span><span class="token function">three</span><span class="token punctuation">;</span>
    <span class="token class-name">FourArgs</span> fourargs <span class="token operator">=</span> <span class="token class-name">This</span><span class="token operator">::</span><span class="token function">four</span><span class="token punctuation">;</span>
    <span class="token class-name">This</span> athis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">This</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    twoargs<span class="token punctuation">.</span><span class="token function">call2</span><span class="token punctuation">(</span>athis<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    threeargs<span class="token punctuation">.</span><span class="token function">call3</span><span class="token punctuation">(</span>athis<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">,</span> <span class="token string">&quot;Three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fourargs<span class="token punctuation">.</span><span class="token function">call4</span><span class="token punctuation">(</span>athis<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">,</span> <span class="token string">&quot;Four&quot;</span><span class="token punctuation">,</span> <span class="token char">&#39;Z&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要指出的是，我将类命名为 <strong>This</strong>，并将函数式方法的第一个参数命名为 <strong>athis</strong>，但你在生产级代码中应该使用其他名字，以防止混淆。</p><h3 id="构造函数引用" tabindex="-1"><a class="header-anchor" href="#构造函数引用" aria-hidden="true">#</a> 构造函数引用</h3><p>你还可以捕获构造函数的引用，然后通过引用调用该构造函数。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/CtorReference.java</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> name<span class="token punctuation">;</span>
  <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// For &quot;unknown&quot;</span>
  <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> name <span class="token operator">=</span> <span class="token string">&quot;stray&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token class-name">String</span> nm<span class="token punctuation">)</span> <span class="token punctuation">{</span> name <span class="token operator">=</span> nm<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token class-name">String</span> nm<span class="token punctuation">,</span> <span class="token keyword">int</span> yrs<span class="token punctuation">)</span> <span class="token punctuation">{</span> name <span class="token operator">=</span> nm<span class="token punctuation">;</span> age <span class="token operator">=</span> yrs<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">MakeNoArgs</span> <span class="token punctuation">{</span>
  <span class="token class-name">Dog</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Make1Arg</span> <span class="token punctuation">{</span>
  <span class="token class-name">Dog</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token class-name">String</span> nm<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Make2Args</span> <span class="token punctuation">{</span>
  <span class="token class-name">Dog</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token class-name">String</span> nm<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CtorReference</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">MakeNoArgs</span> mna <span class="token operator">=</span> <span class="token class-name">Dog</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span> <span class="token comment">// [1]</span>
    <span class="token class-name">Make1Arg</span> m1a <span class="token operator">=</span> <span class="token class-name">Dog</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span>   <span class="token comment">// [2]</span>
    <span class="token class-name">Make2Args</span> m2a <span class="token operator">=</span> <span class="token class-name">Dog</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span>  <span class="token comment">// [3]</span>

    <span class="token class-name">Dog</span> dn <span class="token operator">=</span> mna<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Dog</span> d1 <span class="token operator">=</span> m1a<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">&quot;Comet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Dog</span> d2 <span class="token operator">=</span> m2a<span class="token punctuation">.</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token string">&quot;Ralph&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Dog</strong> 有三个构造函数，函数式接口内的 <code>make()</code> 方法反映了构造函数参数列表（ <code>make()</code> 方法名称可以不同）。</p><p><strong>注意</strong>我们如何对 <strong>[1]</strong>，<strong>[2]</strong> 和 <strong>[3]</strong> 中的每一个使用 <code>Dog :: new</code>。 这三个构造函数只有一个相同名称：<code>:: new</code>，但在每种情况下赋值给不同的接口，编译器可以从中知道具体使用哪个构造函数。</p><p>编译器知道调用函数式方法（本例中为 <code>make()</code>）就相当于调用构造函数。</p><!-- Functional Interfaces --><h2 id="函数式接口" tabindex="-1"><a class="header-anchor" href="#函数式接口" aria-hidden="true">#</a> 函数式接口</h2><p>方法引用和 Lambda 表达式都必须被赋值，同时赋值需要类型信息才能使编译器保证类型的正确性。尤其是Lambda 表达式，它引入了新的要求。 代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>x <span class="token operator">-&gt;</span> x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>我们清楚这里返回类型必须是 <strong>String</strong>，但 <code>x</code> 是什么类型呢？</p><p>Lambda 表达式包含 <em>类型推导</em> （编译器会自动推导出类型信息，避免了程序员显式地声明）。编译器必须能够以某种方式推导出 <code>x</code> 的类型。</p><p>下面是第二个代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">+</span> y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>现在 <code>x</code> 和 <code>y</code> 可以是任何支持 <code>+</code> 运算符连接的数据类型，可以是两个不同的数值类型或者是 一个 <strong>String</strong> 加任意一种可自动转换为 <strong>String</strong> 的数据类型（这包括了大多数类型）。 但是，当 Lambda 表达式被赋值时，编译器必须确定 <code>x</code> 和 <code>y</code> 的确切类型以生成正确的代码。</p><p>该问题也适用于方法引用。 假设你要传递 <code>System.out :: println</code> 到你正在编写的方法 ，你怎么知道传递给方法的参数的类型？</p><p>为了解决这个问题，Java 8 引入了 <code>java.util.function</code> 包。它包含一组接口，这些接口是 Lambda 表达式和方法引用的目标类型。 每个接口只包含一个抽象方法，称为 <em>函数式方法</em> 。</p><p>在编写接口时，可以使用 <code>@FunctionalInterface</code> 注解强制执行此“函数式方法”模式：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/FunctionalAnnotation.java</span>

<span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">interface</span> <span class="token class-name">Functional</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> <span class="token function">goodbye</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">FunctionalNoAnn</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> <span class="token function">goodbye</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
@FunctionalInterface
interface NotFunctional {
  String goodbye(String arg);
  String hello(String arg);
}
产生错误信息:
NotFunctional is not a functional interface
multiple non-overriding abstract methods
found in interface NotFunctional
*/</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FunctionalAnnotation</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">goodbye</span><span class="token punctuation">(</span><span class="token class-name">String</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Goodbye, &quot;</span> <span class="token operator">+</span> arg<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">FunctionalAnnotation</span> fa <span class="token operator">=</span>
      <span class="token keyword">new</span> <span class="token class-name">FunctionalAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Functional</span> f <span class="token operator">=</span> fa<span class="token operator">::</span><span class="token function">goodbye</span><span class="token punctuation">;</span>
    <span class="token class-name">FunctionalNoAnn</span> fna <span class="token operator">=</span> fa<span class="token operator">::</span><span class="token function">goodbye</span><span class="token punctuation">;</span>
    <span class="token comment">// Functional fac = fa; // Incompatible</span>
    <span class="token class-name">Functional</span> fl <span class="token operator">=</span> a <span class="token operator">-&gt;</span> <span class="token string">&quot;Goodbye, &quot;</span> <span class="token operator">+</span> a<span class="token punctuation">;</span>
    <span class="token class-name">FunctionalNoAnn</span> fnal <span class="token operator">=</span> a <span class="token operator">-&gt;</span> <span class="token string">&quot;Goodbye, &quot;</span> <span class="token operator">+</span> a<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>@FunctionalInterface</code> 注解是可选的; Java 会在 <code>main()</code> 中把 <strong>Functional</strong> 和 <strong>FunctionalNoAnn</strong> 都当作函数式接口来看待。 在 <code>NotFunctional</code> 的定义中可看出<code>@FunctionalInterface</code> 的作用：当接口中抽象方法多于一个时产生编译期错误。</p><p>仔细观察在定义 <code>f</code> 和 <code>fna</code> 时发生了什么。 <code>Functional</code> 和 <code>FunctionalNoAnn</code> 声明了是接口，然而被赋值的只是方法 <code>goodbye()</code>。首先，这只是一个方法而不是类；其次，它甚至都不是实现了该接口的类中的方法。这是添加到Java 8中的一点小魔法：如果将方法引用或 Lambda 表达式赋值给函数式接口（类型需要匹配），Java 会适配你的赋值到目标接口。 编译器会在后台把方法引用或 Lambda 表达式包装进实现目标接口的类的实例中。</p><p>虽然 <code>FunctionalAnnotation</code> 确实符合 <code>Functional</code> 模型，但是 Java不允许我们像<code>fac</code>定义的那样，将 <code>FunctionalAnnotation</code> 直接赋值给 <code>Functional</code>，因为 <code>FunctionalAnnotation</code> 并没有显式地去实现 <code>Functional</code> 接口。唯一的惊喜是，Java 8 允许我们将函数赋值给接口，这样的语法更加简单漂亮。</p><p><code>java.util.function</code> 包旨在创建一组完整的目标接口，使得我们一般情况下不需再定义自己的接口。主要因为基本类型的存在，导致预定义的接口数量有少许增加。 如果你了解命名模式，顾名思义就能知道特定接口的作用。</p><p>以下是基本命名准则：</p><ol><li><p>如果只处理对象而非基本类型，名称则为 <code>Function</code>，<code>Consumer</code>，<code>Predicate</code> 等。参数类型通过泛型添加。</p></li><li><p>如果接收的参数是基本类型，则由名称的第一部分表示，如 <code>LongConsumer</code>，<code>DoubleFunction</code>，<code>IntPredicate</code> 等，但返回基本类型的 <code>Supplier</code> 接口例外。</p></li><li><p>如果返回值为基本类型，则用 <code>To</code> 表示，如 <code>ToLongFunction &lt;T&gt;</code> 和 <code>IntToLongFunction</code>。</p></li><li><p>如果返回值类型与参数类型相同，则是一个 <code>Operator</code> ：单个参数使用 <code>UnaryOperator</code>，两个参数使用 <code>BinaryOperator</code>。</p></li><li><p>如果接收参数并返回一个布尔值，则是一个 <strong>谓词</strong> (<code>Predicate</code>)。</p></li><li><p>如果接收的两个参数类型不同，则名称中有一个 <code>Bi</code>。</p></li></ol><p>下表描述了 <code>java.util.function</code> 中的目标类型（包括例外情况）：</p><table><thead><tr><th style="text-align:left;"><strong>特征</strong></th><th style="text-align:center;"><strong>函数式方法名</strong></th><th style="text-align:center;"><strong>示例</strong></th></tr></thead><tbody><tr><td style="text-align:left;">无参数； <br> 无返回值</td><td style="text-align:center;"><strong>Runnable</strong> <br> (java.lang) <br> <code>run()</code></td><td style="text-align:center;"><strong>Runnable</strong></td></tr><tr><td style="text-align:left;">无参数； <br> 返回类型任意</td><td style="text-align:center;"><strong>Supplier</strong> <br> <code>get()</code> <br> <code>getAs类型()</code></td><td style="text-align:center;"><strong>Supplier<code>&lt;T&gt;</code> <br> BooleanSupplier <br> IntSupplier <br> LongSupplier <br> DoubleSupplier</strong></td></tr><tr><td style="text-align:left;">无参数； <br> 返回类型任意</td><td style="text-align:center;"><strong>Callable</strong> <br> (java.util.concurrent) <br> <code>call()</code></td><td style="text-align:center;"><strong>Callable<code>&lt;V&gt;</code></strong></td></tr><tr><td style="text-align:left;">1 参数； <br> 无返回值</td><td style="text-align:center;"><strong>Consumer</strong> <br> <code>accept()</code></td><td style="text-align:center;"><strong><code>Consumer&lt;T&gt;</code> <br> IntConsumer <br> LongConsumer <br> DoubleConsumer</strong></td></tr><tr><td style="text-align:left;">2 参数 <strong>Consumer</strong></td><td style="text-align:center;"><strong>BiConsumer</strong> <br> <code>accept()</code></td><td style="text-align:center;"><strong><code>BiConsumer&lt;T,U&gt;</code></strong></td></tr><tr><td style="text-align:left;">2 参数 <strong>Consumer</strong>； <br> 第一个参数是 引用； <br> 第二个参数是 基本类型</td><td style="text-align:center;"><strong>Obj类型Consumer</strong> <br> <code>accept()</code></td><td style="text-align:center;"><strong><code>ObjIntConsumer&lt;T&gt;</code> <br> <code>ObjLongConsumer&lt;T&gt;</code> <br> <code>ObjDoubleConsumer&lt;T&gt;</code></strong></td></tr><tr><td style="text-align:left;">1 参数； <br> 返回类型不同</td><td style="text-align:center;"><strong>Function</strong> <br> <code>apply()</code> <br> <strong>To类型</strong> 和 <strong>类型To类型</strong> <br> <code>applyAs类型()</code></td><td style="text-align:center;"><strong>Function<code>&lt;T,R&gt;</code> <br> IntFunction<code>&lt;R&gt;</code> <br> <code>LongFunction&lt;R&gt;</code> <br> DoubleFunction<code>&lt;R&gt;</code> <br> ToIntFunction<code>&lt;T&gt;</code> <br> <code>ToLongFunction&lt;T&gt;</code> <br> <code>ToDoubleFunction&lt;T&gt;</code> <br> IntToLongFunction <br> IntToDoubleFunction <br> LongToIntFunction <br> LongToDoubleFunction <br> DoubleToIntFunction <br> DoubleToLongFunction</strong></td></tr><tr><td style="text-align:left;">1 参数； <br> 返回类型相同</td><td style="text-align:center;"><strong>UnaryOperator</strong> <br> <code>apply()</code></td><td style="text-align:center;"><strong><code>UnaryOperator&lt;T&gt;</code> <br> IntUnaryOperator <br> LongUnaryOperator <br> DoubleUnaryOperator</strong></td></tr><tr><td style="text-align:left;">2 参数，类型相同； <br> 返回类型相同</td><td style="text-align:center;"><strong>BinaryOperator</strong> <br> <code>apply()</code></td><td style="text-align:center;"><strong><code>BinaryOperator&lt;T&gt;</code> <br> IntBinaryOperator <br> LongBinaryOperator <br> DoubleBinaryOperator</strong></td></tr><tr><td style="text-align:left;">2 参数，类型相同; <br> 返回整型</td><td style="text-align:center;">Comparator <br> (java.util) <br> <code>compare()</code></td><td style="text-align:center;"><strong><code>Comparator&lt;T&gt;</code></strong></td></tr><tr><td style="text-align:left;">2 参数； <br> 返回布尔型</td><td style="text-align:center;"><strong>Predicate</strong> <br> <code>test()</code></td><td style="text-align:center;"><strong><code>Predicate&lt;T&gt;</code> <br> <code>BiPredicate&lt;T,U&gt;</code> <br> IntPredicate <br> LongPredicate <br> DoublePredicate</strong></td></tr><tr><td style="text-align:left;">参数基本类型； <br> 返回基本类型</td><td style="text-align:center;"><strong>类型To类型Function</strong> <br> <code>applyAs类型()</code></td><td style="text-align:center;"><strong>IntToLongFunction <br> IntToDoubleFunction <br> LongToIntFunction <br> LongToDoubleFunction <br> DoubleToIntFunction <br> DoubleToLongFunction</strong></td></tr><tr><td style="text-align:left;">2 参数； <br>类型不同</td><td style="text-align:center;"><strong>Bi操作</strong> <br> (不同方法名)</td><td style="text-align:center;"><strong><code>BiFunction&lt;T,U,R&gt;</code> <br> <code>BiConsumer&lt;T,U&gt;</code> <br> <code>BiPredicate&lt;T,U&gt;</code> <br> <code>ToIntBiFunction&lt;T,U&gt;</code> <br> <code>ToLongBiFunction&lt;T,U&gt;</code> <br> <code>ToDoubleBiFunction&lt;T&gt;</code></strong></td></tr></tbody></table><p>此表仅提供些常规方案。通过上表，你应该或多或少能自行推导出你所需要的函数式接口。</p><p>可以看出，在创建 <code>java.util.function</code> 时，设计者们做出了一些选择。</p><p>例如，为什么没有 <code>IntComparator</code>，<code>LongComparator</code> 和 <code>DoubleComparator</code> 呢？有 <code>BooleanSupplier</code> 却没有其他表示 <strong>Boolean</strong> 的接口；有通用的 <code>BiConsumer</code> 却没有用于 <strong>int</strong>，<strong>long</strong> 和 <strong>double</strong> 的 <code>BiConsumers</code> 变体（我理解他们为什么放弃这些接口）。这到底是疏忽还是有人认为其他组合使用得很少呢（他们是如何得出这个结论的）？</p><p>你还可以看到基本类型给 Java 添加了多少复杂性。该语言的第一版中就包含了基本类型，原因是考虑效率问题（该问题很快就缓解了）。现在，在语言的生命周期里，我们一直忍受语言设计的糟糕选择所带来的影响。</p><p>下面枚举了基于 Lambda 表达式的所有不同 <strong>Function</strong> 变体的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/FunctionVariants.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>
  <span class="token class-name">Foo</span> f<span class="token punctuation">;</span>
  <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token class-name">Foo</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>f <span class="token operator">=</span> f<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">IBaz</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span>
  <span class="token class-name">IBaz</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>i <span class="token operator">=</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">LBaz</span> <span class="token punctuation">{</span>
  <span class="token keyword">long</span> l<span class="token punctuation">;</span>
  <span class="token class-name">LBaz</span><span class="token punctuation">(</span><span class="token keyword">long</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>l <span class="token operator">=</span> l<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">DBaz</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> d<span class="token punctuation">;</span>
  <span class="token class-name">DBaz</span><span class="token punctuation">(</span><span class="token keyword">double</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>d <span class="token operator">=</span> d<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FunctionVariants</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Foo</span><span class="token punctuation">,</span><span class="token class-name">Bar</span><span class="token punctuation">&gt;</span></span> f1 <span class="token operator">=</span> f <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">IntFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IBaz</span><span class="token punctuation">&gt;</span></span> f2 <span class="token operator">=</span> i <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">IBaz</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">LongFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LBaz</span><span class="token punctuation">&gt;</span></span> f3 <span class="token operator">=</span> l <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">LBaz</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">DoubleFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DBaz</span><span class="token punctuation">&gt;</span></span> f4 <span class="token operator">=</span> d <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">DBaz</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">ToIntFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IBaz</span><span class="token punctuation">&gt;</span></span> f5 <span class="token operator">=</span> ib <span class="token operator">-&gt;</span> ib<span class="token punctuation">.</span>i<span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">ToLongFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LBaz</span><span class="token punctuation">&gt;</span></span> f6 <span class="token operator">=</span> lb <span class="token operator">-&gt;</span> lb<span class="token punctuation">.</span>l<span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">ToDoubleFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DBaz</span><span class="token punctuation">&gt;</span></span> f7 <span class="token operator">=</span> db <span class="token operator">-&gt;</span> db<span class="token punctuation">.</span>d<span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">IntToLongFunction</span> f8 <span class="token operator">=</span> i <span class="token operator">-&gt;</span> i<span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">IntToDoubleFunction</span> f9 <span class="token operator">=</span> i <span class="token operator">-&gt;</span> i<span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">LongToIntFunction</span> f10 <span class="token operator">=</span> l <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>l<span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">LongToDoubleFunction</span> f11 <span class="token operator">=</span> l <span class="token operator">-&gt;</span> l<span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">DoubleToIntFunction</span> f12 <span class="token operator">=</span> d <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>d<span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">DoubleToLongFunction</span> f13 <span class="token operator">=</span> d <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>d<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Bar</span> b <span class="token operator">=</span> f1<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IBaz</span> ib <span class="token operator">=</span> f2<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LBaz</span> lb <span class="token operator">=</span> f3<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DBaz</span> db <span class="token operator">=</span> f4<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> f5<span class="token punctuation">.</span><span class="token function">applyAsInt</span><span class="token punctuation">(</span>ib<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> l <span class="token operator">=</span> f6<span class="token punctuation">.</span><span class="token function">applyAsLong</span><span class="token punctuation">(</span>lb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> d <span class="token operator">=</span> f7<span class="token punctuation">.</span><span class="token function">applyAsDouble</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
    l <span class="token operator">=</span> f8<span class="token punctuation">.</span><span class="token function">applyAsLong</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    d <span class="token operator">=</span> f9<span class="token punctuation">.</span><span class="token function">applyAsDouble</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    i <span class="token operator">=</span> f10<span class="token punctuation">.</span><span class="token function">applyAsInt</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    d <span class="token operator">=</span> f11<span class="token punctuation">.</span><span class="token function">applyAsDouble</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    i <span class="token operator">=</span> f12<span class="token punctuation">.</span><span class="token function">applyAsInt</span><span class="token punctuation">(</span><span class="token number">13.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    l <span class="token operator">=</span> f13<span class="token punctuation">.</span><span class="token function">applyAsLong</span><span class="token punctuation">(</span><span class="token number">13.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这些 Lambda 表达式尝试生成适合函数签名的最简代码。 在某些情况下有必要进行强制类型转换，否则编译器会报截断错误。</p><p><code>main()</code>中的每个测试都显示了 <code>Function</code> 接口中不同类型的 <code>apply()</code> 方法。 每个都产生一个与其关联的 Lambda 表达式的调用。</p><p>方法引用有自己的小魔法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">/</span> functional<span class="token operator">/</span><span class="token class-name">MethodConversion</span><span class="token punctuation">.</span>java

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">In1</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">In2</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodConversion</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">In1</span> i1<span class="token punctuation">,</span> <span class="token class-name">In2</span> i2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;accept()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">someOtherName</span><span class="token punctuation">(</span><span class="token class-name">In1</span> i1<span class="token punctuation">,</span> <span class="token class-name">In2</span> i2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;someOtherName()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">In1</span><span class="token punctuation">,</span><span class="token class-name">In2</span><span class="token punctuation">&gt;</span></span> bic<span class="token punctuation">;</span>

    bic <span class="token operator">=</span> <span class="token class-name">MethodConversion</span><span class="token operator">::</span><span class="token function">accept</span><span class="token punctuation">;</span>
    bic<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">In1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">In2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    bic <span class="token operator">=</span> <span class="token class-name">MethodConversion</span><span class="token operator">::</span><span class="token function">someOtherName</span><span class="token punctuation">;</span>
    <span class="token comment">// bic.someOtherName(new In1(), new In2()); // Nope</span>
    bic<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">In1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">In2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>accept()
someOtherName()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>查看 <code>BiConsumer</code> 的文档，你会看到它的函数式方法为 <code>accept()</code> 。 的确，如果我们将方法命名为 <code>accept()</code>，它就可以作为方法引用。 但是我们也可用不同的名称，比如 <code>someOtherName()</code>。只要参数类型、返回类型与 <code>BiConsumer</code> 的 <code>accept()</code> 相同即可。</p><p>因此，在使用函数接口时，名称无关紧要——只要参数类型和返回类型相同。 Java 会将你的方法映射到接口方法。 要调用方法，可以调用接口的函数式方法名（在本例中为 <code>accept()</code>），而不是你的方法名。</p><p>现在我们来看看，将方法引用应用于基于类的函数式接口（即那些不包含基本类型的函数式接口）。下面的例子中，我创建了适合函数式方法签名的最简单的方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/ClassFunctionals.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AA</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">BB</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">CC</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassFunctionals</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token class-name">AA</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token class-name">AA</span> aa1<span class="token punctuation">,</span> <span class="token class-name">AA</span> aa2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f3</span><span class="token punctuation">(</span><span class="token class-name">AA</span> aa<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f4</span><span class="token punctuation">(</span><span class="token class-name">AA</span> aa<span class="token punctuation">,</span> <span class="token class-name">BB</span> bb<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token class-name">CC</span> <span class="token function">f5</span><span class="token punctuation">(</span><span class="token class-name">AA</span> aa<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token class-name">CC</span> <span class="token function">f6</span><span class="token punctuation">(</span><span class="token class-name">AA</span> aa<span class="token punctuation">,</span> <span class="token class-name">BB</span> bb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">f7</span><span class="token punctuation">(</span><span class="token class-name">AA</span> aa<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">f8</span><span class="token punctuation">(</span><span class="token class-name">AA</span> aa<span class="token punctuation">,</span> <span class="token class-name">BB</span> bb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token class-name">AA</span> <span class="token function">f9</span><span class="token punctuation">(</span><span class="token class-name">AA</span> aa<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token class-name">AA</span> <span class="token function">f10</span><span class="token punctuation">(</span><span class="token class-name">AA</span> aa1<span class="token punctuation">,</span> <span class="token class-name">AA</span> aa2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span>AA<span class="token punctuation">&gt;</span></span> s <span class="token operator">=</span> <span class="token class-name">ClassFunctionals</span><span class="token operator">::</span><span class="token function">f1</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span>AA<span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token class-name">ClassFunctionals</span><span class="token operator">::</span><span class="token function">f2</span><span class="token punctuation">;</span>
    c<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span>AA<span class="token punctuation">&gt;</span></span> cons <span class="token operator">=</span> <span class="token class-name">ClassFunctionals</span><span class="token operator">::</span><span class="token function">f3</span><span class="token punctuation">;</span>
    cons<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span>AA<span class="token punctuation">,</span>BB<span class="token punctuation">&gt;</span></span> bicons <span class="token operator">=</span> <span class="token class-name">ClassFunctionals</span><span class="token operator">::</span><span class="token function">f4</span><span class="token punctuation">;</span>
    bicons<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span>AA<span class="token punctuation">,</span>CC<span class="token punctuation">&gt;</span></span> f <span class="token operator">=</span> <span class="token class-name">ClassFunctionals</span><span class="token operator">::</span><span class="token function">f5</span><span class="token punctuation">;</span>
    <span class="token class-name">CC</span> cc <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span>AA<span class="token punctuation">,</span>BB<span class="token punctuation">,</span>CC<span class="token punctuation">&gt;</span></span> bif <span class="token operator">=</span> <span class="token class-name">ClassFunctionals</span><span class="token operator">::</span><span class="token function">f6</span><span class="token punctuation">;</span>
    cc <span class="token operator">=</span> bif<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span>AA<span class="token punctuation">&gt;</span></span> p <span class="token operator">=</span> <span class="token class-name">ClassFunctionals</span><span class="token operator">::</span><span class="token function">f7</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BiPredicate</span><span class="token generics"><span class="token punctuation">&lt;</span>AA<span class="token punctuation">,</span>BB<span class="token punctuation">&gt;</span></span> bip <span class="token operator">=</span> <span class="token class-name">ClassFunctionals</span><span class="token operator">::</span><span class="token function">f8</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> bip<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">UnaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span>AA<span class="token punctuation">&gt;</span></span> uo <span class="token operator">=</span> <span class="token class-name">ClassFunctionals</span><span class="token operator">::</span><span class="token function">f9</span><span class="token punctuation">;</span>
    <span class="token class-name">AA</span> aa <span class="token operator">=</span> uo<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BinaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span>AA<span class="token punctuation">&gt;</span></span> bo <span class="token operator">=</span> <span class="token class-name">ClassFunctionals</span><span class="token operator">::</span><span class="token function">f10</span><span class="token punctuation">;</span>
    aa <span class="token operator">=</span> bo<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>请<strong>注意</strong>，每个方法名称都是随意的（如 <code>f1()</code>，<code>f2()</code>等）。正如你刚才看到的，一旦将方法引用赋值给函数接口，我们就可以调用与该接口关联的函数方法。 在此示例中为 <code>get()</code>、<code>compare()</code>、<code>accept()</code>、<code>apply()</code> 和 <code>test()</code>。</p><!-- Functional Interfaces with More Arguments --><h3 id="多参数函数式接口" tabindex="-1"><a class="header-anchor" href="#多参数函数式接口" aria-hidden="true">#</a> 多参数函数式接口</h3><p><code>java.util.functional</code> 中的接口是有限的。比如有 <code>BiFunction</code>，但也仅此而已。 如果需要三参数函数的接口怎么办？ 其实这些接口非常简单，很容易查看 Java 库源代码并自行创建。代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/TriFunction.java</span>

<span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TriFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">R</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">,</span> <span class="token class-name">U</span> u<span class="token punctuation">,</span> <span class="token class-name">V</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>简单测试，验证它是否有效：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/TriFunctionTest.java</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TriFunctionTest</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">long</span> l<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">99</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">TriFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> tf <span class="token operator">=</span>
      <span class="token class-name">TriFunctionTest</span><span class="token operator">::</span><span class="token function">f</span><span class="token punctuation">;</span>
    tf <span class="token operator">=</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> l<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token number">12</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里我们同时测试了方法引用和 Lambda 表达式。</p><h3 id="缺少基本类型的函数" tabindex="-1"><a class="header-anchor" href="#缺少基本类型的函数" aria-hidden="true">#</a> 缺少基本类型的函数</h3><p>让我们重温一下 <code>BiConsumer</code>，看看我们将如何创建各种缺失的预定义组合，涉及 <strong>int</strong>，<strong>long</strong> 和 <strong>double</strong> （基本类型）：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/BiConsumerPermutations.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BiConsumerPermutations</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> bicid <span class="token operator">=</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%d, %f%n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> bicdi <span class="token operator">=</span> <span class="token punctuation">(</span>d<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%d, %f%n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> bicil <span class="token operator">=</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> l<span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%d, %d%n&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bicid<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">11.34</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bicdi<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token number">22.45</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bicil<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>47, 11.340000
92, 22.450000
1, 11
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里使用 <code>System.out.format()</code> 来显示。它类似于 <code>System.out.println()</code> 但提供了更多的显示选项。 这里，<code>%f</code> 表示我将 <code>n</code> 作为浮点值给出，<code>%d</code> 表示 <code>n</code> 是一个整数值。 这其中可以包含空格，输入 <code>%n</code> 会换行 — 当然使用传统的 <code>\n</code> 也能换行，但 <code>%n</code> 是自动跨平台的，这是使用 <code>format()</code> 的另一个原因。</p><p>上例只是简单使用了合适的包装类型，而装箱和拆箱负责它与基本类型之间的来回转换。 又比如，我们可以将包装类型和<code>Function</code>一起使用，而不去用各种针对基本类型的预定义接口。代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/FunctionWithWrapped.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FunctionWithWrapped</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> fid <span class="token operator">=</span> i <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>i<span class="token punctuation">;</span>
    <span class="token class-name">IntToDoubleFunction</span> fid2 <span class="token operator">=</span> i <span class="token operator">-&gt;</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果没有强制转换，则会收到错误消息：“Integer cannot be converted to Double”（<strong>Integer</strong> 无法转换为 <strong>Double</strong>），而使用 <strong>IntToDoubleFunction</strong> 就没有此类问题。 <strong>IntToDoubleFunction</strong> 接口的源代码是这样的：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span> 
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IntToDoubleFunction</span> <span class="token punctuation">{</span> 
  <span class="token keyword">double</span> <span class="token function">applyAsDouble</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为我们可以简单地写 <code>Function &lt;Integer，Double&gt;</code> 并产生正常的结果，所以用基本类型（<code>IntToDoubleFunction</code>）的唯一理由是可以避免传递参数和返回结果过程中的自动拆装箱，进而提升性能。</p><p>似乎是考虑到使用频率，某些函数类型并没有预定义。</p><p>当然，如果因为缺少针对基本类型的函数式接口造成了性能问题，你可以轻松编写自己的接口（ 参考 Java 源代码）——尽管这里出现性能瓶颈的可能性不大。</p><!-- Higher-Order Functions--><h2 id="高阶函数" tabindex="-1"><a class="header-anchor" href="#高阶函数" aria-hidden="true">#</a> 高阶函数</h2><p>这个名字可能听起来令人生畏，但是：<a href="https://en.wikipedia.org/wiki/Higher-order_function" target="_blank" rel="noopener noreferrer">高阶函数<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>（Higher-order Function）只是一个消费或产生函数的函数。</p><p>我们先来看看如何产生一个函数：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/ProduceFunction.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">interface</span>
<span class="token class-name">FuncSS</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// [1]</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProduceFunction</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token class-name">FuncSS</span> <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [2]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">FuncSS</span> f <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">&quot;YELLING&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yelling
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这里，<code>produce()</code> 是高阶函数。</p><p><strong>[1]</strong> 使用继承，可以轻松地为专用接口创建别名。</p><p><strong>[2]</strong> 使用 Lambda 表达式，可以轻松地在方法中创建和返回一个函数。</p><p>要消费一个函数，消费函数需要在参数列表正确地描述函数类型。代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/ConsumeFunction.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">One</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Two</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumeFunction</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token class-name">Two</span> <span class="token function">consume</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">One</span><span class="token punctuation">,</span><span class="token class-name">Two</span><span class="token punctuation">&gt;</span></span> onetwo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> onetwo<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">One</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Two</span> two <span class="token operator">=</span> <span class="token function">consume</span><span class="token punctuation">(</span>one <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Two</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当基于消费函数生成新函数时，事情就变得相当有趣了。代码示例如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/TransformFunction.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">I</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;I&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">O</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;O&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransformFunction</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">I</span><span class="token punctuation">,</span><span class="token class-name">O</span><span class="token punctuation">&gt;</span></span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">I</span><span class="token punctuation">,</span><span class="token class-name">O</span><span class="token punctuation">&gt;</span></span> in<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> in<span class="token punctuation">.</span><span class="token function">andThen</span><span class="token punctuation">(</span>o <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">I</span><span class="token punctuation">,</span><span class="token class-name">O</span><span class="token punctuation">&gt;</span></span> f2 <span class="token operator">=</span> <span class="token function">transform</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">O</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">O</span> o <span class="token operator">=</span> f2<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">I</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>I
O
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在这里，<code>transform()</code> 生成一个与传入的函数具有相同签名的函数，但是你可以生成任何你想要的类型。</p><p>这里使用到了 <code>Function</code> 接口中名为 <code>andThen()</code> 的默认方法，该方法专门用于操作函数。 顾名思义，在调用 <code>in</code> 函数之后调用 <code>andThen()</code>（还有个 <code>compose()</code> 方法，它在 <code>in</code> 函数之前应用新函数）。 要附加一个 <code>andThen()</code> 函数，我们只需将该函数作为参数传递。 <code>transform()</code> 产生的是一个新函数，它将 <code>in</code> 的动作与 <code>andThen()</code> 参数的动作结合起来。</p><!-- Closures --><h2 id="闭包" tabindex="-1"><a class="header-anchor" href="#闭包" aria-hidden="true">#</a> 闭包</h2><p>在上一节的 <code>ProduceFunction.java</code> 中，我们从方法中返回 Lambda 函数。 虽然过程简单，但是有些问题必须再回过头来探讨一下。</p><p><strong>闭包</strong>（Closure）一词总结了这些问题。 它非常重要，利用闭包可以轻松生成函数。</p><p>考虑一个更复杂的 Lambda，它使用函数作用域之外的变量。 返回该函数会发生什么？ 也就是说，当你调用函数时，它对那些 “外部 ”变量引用了什么? 如果语言不能自动解决，那问题将变得非常棘手。 能够解决这个问题的语言被称作 <em>支持闭包</em>，或者称作 <em>词法定界</em>（<em>lexically scoped</em> ，基于词法作用域的）( 也有用术语 <em>变量捕获</em> <em>variable capture</em> 称呼的)。Java 8 提供了有限但合理的闭包支持，我们将用一些简单的例子来研究它。</p><p>首先，下列方法返回一个函数，该函数访问对象字段和方法参数：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/Closure1.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Closure1</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span>
  <span class="token class-name">IntSupplier</span> <span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">+</span> i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是，仔细考虑一下，<code>i</code> 的这种用法并非是个大难题，因为对象很可能在你调用 <code>makeFun()</code> 之后就存在了——实际上，垃圾收集器几乎肯定会保留以这种方式被绑定到现存函数的对象[^5]。当然，如果你对同一个对象多次调用 <code>makeFun()</code> ，你最终会得到多个函数，它们共享 <code>i</code> 的存储空间：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/SharedStorage.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SharedStorage</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Closure1</span> c1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Closure1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IntSupplier</span> f1 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IntSupplier</span> f2 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IntSupplier</span> f3 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span><span class="token function">getAsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">getAsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f3<span class="token punctuation">.</span><span class="token function">getAsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>0
1
2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每次调用 <code>getAsInt()</code> 都会增加 <code>i</code>，表明存储是共享的。</p><p>如果 <code>i</code> 是 <code>makeFun()</code> 的局部变量怎么办？ 在正常情况下，当 <code>makeFun()</code> 完成时 <code>i</code> 就消失。 但它仍可以编译：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/Closure2.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Closure2</span> <span class="token punctuation">{</span>
  <span class="token class-name">IntSupplier</span> <span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">+</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由 <code>makeFun()</code> 返回的 <code>IntSupplier</code> “关住了” <code>i</code> 和 <code>x</code>，因此即使<code>makeFun()</code>已执行完毕，当你调用返回的函数时<code>i</code> 和 <code>x</code>仍然有效，而不是像正常情况下那样在 <code>makeFun()</code> 执行后 <code>i</code> 和<code>x</code>就消失了。 但请注意，我没有像 <code>Closure1.java</code> 那样递增 <code>i</code>，因为会产生编译时错误。代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/Closure3.java</span>

<span class="token comment">// {WillNotCompile}</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Closure3</span> <span class="token punctuation">{</span>
  <span class="token class-name">IntSupplier</span> <span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// x++ 和 i++ 都会报错：</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x<span class="token operator">++</span> <span class="token operator">+</span> i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>x</code> 和 <code>i</code> 的操作都犯了同样的错误：被 Lambda 表达式引用的局部变量必须是 <code>final</code> 或者是等同 <code>final</code> 效果的。</p><p>如果使用 <code>final</code> 修饰 <code>x</code>和 <code>i</code>，就不能再递增它们的值了。代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/Closure4.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Closure4</span> <span class="token punctuation">{</span>
  <span class="token class-name">IntSupplier</span> <span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">+</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那么为什么在 <code>Closure2.java</code> 中， <code>x</code> 和 <code>i</code> 非 <code>final</code> 却可以运行呢？</p><p>这就叫做<strong>等同 final 效果</strong>（Effectively Final）。这个术语是在 Java 8 才开始出现的，表示虽然没有明确地声明变量是 <code>final</code> 的，但是因变量值没被改变过而实际有了 <code>final</code> 同等的效果。 如果局部变量的初始值永远不会改变，那么它实际上就是 <code>final</code> 的。</p><p>如果 <code>x</code> 和 <code>i</code> 的值在方法中的其他位置发生改变（但不在返回的函数内部），则编译器仍将视其为错误。每个递增操作则会分别产生错误消息。代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/Closure5.java</span>

<span class="token comment">// {无法编译成功}</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Closure5</span> <span class="token punctuation">{</span>
  <span class="token class-name">IntSupplier</span> <span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    i<span class="token operator">++</span><span class="token punctuation">;</span>
    x<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">+</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>等同 final 效果</strong>意味着可以在变量声明前加上 <strong>final</strong> 关键字而不用更改任何其余代码。 实际上它就是具备 <code>final</code> 效果的，只是没有明确说明。</p><p>在闭包中，在使用 <code>x</code> 和 <code>i</code> 之前，通过将它们赋值给 <code>final</code> 修饰的变量，我们解决了 <code>Closure5.java</code> 中遇到的问题。代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
<span class="token comment">// functional/Closure6.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Closure6</span> <span class="token punctuation">{</span>
  <span class="token class-name">IntSupplier</span> <span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    i<span class="token operator">++</span><span class="token punctuation">;</span>
    x<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> iFinal <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> xFinal <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> xFinal <span class="token operator">+</span> iFinal<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上例中 <code>iFinal</code> 和 <code>xFinal</code> 的值在赋值后并没有改变过，因此在这里使用 <code>final</code> 是多余的。</p><p>如果改用包装类型会是什么情况呢？我们可以把<code>int</code>类型改为<code>Integer</code>类型研究一下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/Closure7.java</span>

<span class="token comment">// {无法编译成功}</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Closure7</span> <span class="token punctuation">{</span>
  <span class="token class-name">IntSupplier</span> <span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Integer</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">+</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译器非常聪明地识别到变量 <code>i</code> 的值被更改过。 包装类型可能是被特殊处理了，我们再尝试下 <strong>List</strong>：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/Closure8.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Closure8</span> <span class="token punctuation">{</span>
  <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> ai <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ai<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> ai<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Closure8</span> c7 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Closure8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span>
      l1 <span class="token operator">=</span> c7<span class="token punctuation">.</span><span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      l2 <span class="token operator">=</span> c7<span class="token punctuation">.</span><span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    l1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    l2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[1]
[1]
[1, 42]
[1, 96]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，这次一切正常。我们改变了 <strong>List</strong> 的内容却没产生编译时错误。通过观察本例的输出结果，我们发现这看起来非常安全。这是因为每次调用 <code>makeFun()</code> 时，其实都会创建并返回一个全新而非共享的 <code>ArrayList</code>。也就是说，每个闭包都有自己独立的 <code>ArrayList</code>，它们之间互不干扰。</p><p>请<strong>注意</strong>我已经声明 <code>ai</code> 是 <code>final</code> 的了。尽管在这个例子中你可以去掉 <code>final</code> 并得到相同的结果（试试吧！）。 应用于对象引用的 <code>final</code> 关键字仅表示不会重新赋值引用。 它并不代表你不能修改对象本身。</p><p>我们来看看 <code>Closure7.java</code> 和 <code>Closure8.java</code> 之间的区别。我们看到：在 <code>Closure7.java</code> 中变量 <code>i</code> 有过重新赋值。 也许这就是触发<strong>等同 final 效果</strong>错误消息的原因。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/Closure9.java</span>

<span class="token comment">// {无法编译成功}</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Closure9</span> <span class="token punctuation">{</span>
  <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> ai <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ai <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reassignment</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> ai<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上例，重新赋值引用会触发错误消息。如果只修改指向的对象则没问题，只要没有其他人获得对该对象的引用（这意味着你有多个实体可以修改对象，此时事情会变得非常混乱），基本上就是安全的[^6]。</p><p>让我们回顾一下 <code>Closure1.java</code>。那么现在问题来了：为什么变量 <code>i</code> 被修改编译器却没有报错呢。 它既不是 <code>final</code> 的，也不是<strong>等同 final 效果</strong>的。因为 <code>i</code> 是外部类的成员，所以这样做肯定是安全的（除非你正在创建共享可变内存的多个函数）。是的，你可以辩称在这种情况下不会发生变量捕获（Variable Capture）。但可以肯定的是，<code>Closure3.java</code> 的错误消息是专门针对局部变量的。因此，规则并非只是 “在 Lambda 之外定义的任何变量必须是 <code>final</code> 的或<strong>等同 final 效果</strong>” 那么简单。相反，你必须考虑捕获的变量是否是<strong>等同 final 效果</strong>的。 如果它是对象中的字段（实例变量），那么它有独立的生命周期，不需要任何特殊的捕获以便稍后在调用 Lambda 时存在。（注：结论是——Lambda 可以没有限制地引用 实例变量和静态变量。但 局部变量必须显式声明为final，或事实上是final 。）</p><!-- Inner Classes as Closures --><h3 id="作为闭包的内部类" tabindex="-1"><a class="header-anchor" href="#作为闭包的内部类" aria-hidden="true">#</a> 作为闭包的内部类</h3><p>我们可以使用匿名内部类重写之前的例子:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/AnonymousClosure.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnonymousClosure</span> <span class="token punctuation">{</span>
  <span class="token class-name">IntSupplier</span> <span class="token function">makeFun</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// 同样规则的应用:</span>
    <span class="token comment">// i++; // 非等同 final 效果</span>
    <span class="token comment">// x++; // 同上</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IntSupplier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> i<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实际上只要有内部类，就会有闭包（Java 8 只是简化了闭包操作）。在 Java 8 之前，变量 <code>x</code> 和 <code>i</code> 必须被明确声明为 <code>final</code>。在 Java 8 中，内部类的规则放宽，包括<strong>等同 final 效果</strong>。</p><!-- Function Composition --><h2 id="函数组合" tabindex="-1"><a class="header-anchor" href="#函数组合" aria-hidden="true">#</a> 函数组合</h2><p>函数组合（Function Composition）意为“多个函数组合成新函数”。它通常是函数式编程的基本组成部分。在前面的 <code>TransformFunction.java</code> 类中，就有一个使用 <code>andThen()</code> 的函数组合示例。一些 <code>java.util.function</code> 接口中包含支持函数组合的方法 [^7]。</p><table><thead><tr><th style="text-align:left;">组合方法</th><th style="text-align:left;">支持接口</th></tr></thead><tbody><tr><td style="text-align:left;"><code>andThen(argument)</code> <br> 执行原操作,再执行参数操作</td><td style="text-align:left;"><strong>Function <br> BiFunction <br> Consumer <br> BiConsumer <br> IntConsumer <br> LongConsumer <br> DoubleConsumer <br> UnaryOperator <br> IntUnaryOperator <br> LongUnaryOperator <br> DoubleUnaryOperator <br> BinaryOperator</strong></td></tr><tr><td style="text-align:left;"><code>compose(argument)</code> <br> 执行参数操作,再执行原操作</td><td style="text-align:left;"><strong>Function <br> UnaryOperator <br> IntUnaryOperator <br> LongUnaryOperator <br> DoubleUnaryOperator</strong></td></tr><tr><td style="text-align:left;"><code>and(argument)</code> <br> 原谓词(Predicate)和参数谓词的短路<strong>逻辑与</strong></td><td style="text-align:left;"><strong>Predicate <br> BiPredicate <br> IntPredicate <br> LongPredicate <br> DoublePredicate</strong></td></tr><tr><td style="text-align:left;"><code>or(argument)</code> <br> 原谓词和参数谓词的短路<strong>逻辑或</strong></td><td style="text-align:left;"><strong>Predicate <br> BiPredicate <br> IntPredicate <br> LongPredicate <br> DoublePredicate</strong></td></tr><tr><td style="text-align:left;"><code>negate()</code> <br> 该谓词的<strong>逻辑非</strong></td><td style="text-align:left;"><strong>Predicate <br> BiPredicate <br> IntPredicate <br> LongPredicate <br> DoublePredicate</strong></td></tr></tbody></table><p>下例使用了 <code>Function</code> 里的 <code>compose()</code>和 <code>andThen()</code>。代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/FunctionComposition.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FunctionComposition</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>
    f1 <span class="token operator">=</span> s <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token char">&#39;A&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;_&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    f2 <span class="token operator">=</span> s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    f3 <span class="token operator">=</span> s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    f4 <span class="token operator">=</span> f1<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andThen</span><span class="token punctuation">(</span>f3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>
      f4<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">&quot;GO AFTER ALL AMBULANCES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>AFTER ALL AMBULANCES
_fter _ll _mbul_nces
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>这里我们重点看正在创建的新函数 <code>f4</code>。它调用 <code>apply()</code> 的方式与常规几乎无异[^8]。</p><p>当 <code>f1</code> 获得字符串时，它已经被<code>f2</code> 剥离了前三个字符。这是因为 <code>compose（f2）</code> 表示 <code>f2</code> 的调用发生在 <code>f1</code> 之前。</p><p>下例是 谓词(<code>Predicate</code>) 的逻辑运算演示.代码示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/PredicateComposition.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PredicateComposition</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>
    p1 <span class="token operator">=</span> s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    p2 <span class="token operator">=</span> s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span>
    p3 <span class="token operator">=</span> s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    p4 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foobar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foobaz&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fongopuckey&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p4<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>foobar
foobaz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>p4</code> 获取到了所有谓词(<code>Predicate</code>)并组合成一个更复杂的谓词。解读：如果字符串中不包含 <code>bar</code> 且长度小于 5，或者它包含 <code>foo</code> ，则结果为 <code>true</code>。</p><p>正因它产生如此清晰的语法，我在主方法中采用了一些小技巧，并借用了下一章的内容。首先，我创建了一个字符串对象的流，然后将每个对象传递给 <code>filter()</code> 操作。 <code>filter()</code> 使用 <code>p4</code> 的谓词来确定对象的去留。最后我们使用 <code>forEach()</code> 将 <code>println</code> 方法引用应用在每个留存的对象上。</p><p>从输出结果我们可以看到 <code>p4</code> 的工作流程：任何带有 <code>&quot;foo&quot;</code> 的字符串都得以保留，即使它的长度大于 5。 <code>&quot;fongopuckey&quot;</code> 因长度超出且不包含 <code>foo</code> 而被丢弃。</p><!-- Currying and  Partial Evaluation --><h2 id="柯里化和部分求值" tabindex="-1"><a class="header-anchor" href="#柯里化和部分求值" aria-hidden="true">#</a> 柯里化和部分求值</h2><p><a href="https://en.wikipedia.org/wiki/Currying" target="_blank" rel="noopener noreferrer">柯里化<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>（Currying）的名称来自于其发明者之一 <em>Haskell Curry</em>。他可能是计算机领域唯一姓氏和名字都命名过重要概念的人（另外就是 Haskell 编程语言）。 柯里化意为：将一个多参数的函数，转换为一系列单参数函数。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/CurryingAndPartials.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CurryingAndPartials</span> <span class="token punctuation">{</span>
   <span class="token comment">// 未柯里化:</span>
   <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">uncurried</span><span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token class-name">String</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 柯里化的函数:</span>
      <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> sum <span class="token operator">=</span>
         a <span class="token operator">-&gt;</span> b <span class="token operator">-&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token comment">// [1]</span>

      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">uncurried</span><span class="token punctuation">(</span><span class="token string">&quot;Hi &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Ho&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>
        hi <span class="token operator">=</span> sum<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">&quot;Hi &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [2]</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hi<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">&quot;Ho&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 部分应用:</span>
      <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sumHi <span class="token operator">=</span>
        sum<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">&quot;Hup &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sumHi<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">&quot;Ho&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sumHi<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">&quot;Hey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Hi Ho
Hi Ho
Hup Ho
Hup Hey
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>[1]</strong> 这一连串的箭头很巧妙。<em>注意</em>，在函数接口声明中，第二个参数是另一个函数。</p><p><strong>[2]</strong> 柯里化的目的是能够通过提供单个参数来创建一个新函数，所以现在有了一个“带参函数”和剩下的 “自由函数”（free argument） 。实际上，你从一个双参数函数开始，最后得到一个单参数函数。</p><p>我们可以通过继续添加层级来柯里化一个三参数函数：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/Curry3Args.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Curry3Args</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span>
        <span class="token class-name">Function</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span>
          <span class="token class-name">Function</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> sum <span class="token operator">=</span>
            a <span class="token operator">-&gt;</span> b <span class="token operator">-&gt;</span> c <span class="token operator">-&gt;</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">;</span>
      <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span>
        <span class="token class-name">Function</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> hi <span class="token operator">=</span>
          sum<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">&quot;Hi &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ho <span class="token operator">=</span>
        hi<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">&quot;Ho &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ho<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">&quot;Hup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Hi Ho Hup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>对于每一级的箭头级联（Arrow-cascading），你都会在类型声明周围包裹另一个 <strong>Function</strong> 。</p><p>处理基本类型和装箱时，请使用适当的函数式接口：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// functional/CurriedIntAdd.java</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CurriedIntAdd</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">IntFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IntUnaryOperator</span><span class="token punctuation">&gt;</span></span>
      curriedIntAdd <span class="token operator">=</span> a <span class="token operator">-&gt;</span> b <span class="token operator">-&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token class-name">IntUnaryOperator</span> add4 <span class="token operator">=</span> curriedIntAdd<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>add4<span class="token punctuation">.</span><span class="token function">applyAsInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可以在互联网上找到更多的柯里化示例。通常它们是用 Java 之外的语言实现的，但如果理解了柯里化的基本概念，你可以很轻松地用 Java 实现它们。</p><!-- Pure Functional Programming --><h2 id="纯函数式编程" tabindex="-1"><a class="header-anchor" href="#纯函数式编程" aria-hidden="true">#</a> 纯函数式编程</h2><p>只要多加练习，用没有函数式支持的语言也可以写出纯函数式程序（即使是 C 这样的原始语言）。Java 8 让函数式编程更简单，不过我们要确保一切是 <code>final</code> 的，同时你的所有方法和函数没有副作用。因为 Java 在本质上并非是不可变语言，所以编译器对我们犯的错误将无能为力。</p><p>这种情况下，我们可以借助第三方工具[^9]，但使用 Scala 或 Clojure 这样的语言可能更简单。因为它们从一开始就是为保持不变性而设计的。你可以采用这些语言来编写你的 Java 项目的一部分。如果必须要用纯函数式编写，则可以用 Scala（需要一些练习） 或 Clojure （仅需更少的练习）。虽然 Java 支持<a href="/OnJava8/book/24-Concurrent-Programming.html" class="">并发编程</a>，但如果这是你项目的核心部分，你应该考虑在项目部分功能中使用 <code>Scala</code> 或 <code>Clojure</code> 之类的语言。</p><!-- Summary --><h2 id="本章小结" tabindex="-1"><a class="header-anchor" href="#本章小结" aria-hidden="true">#</a> 本章小结</h2><p>Lambda 表达式和方法引用并没有将 Java 转换成函数式语言，而是提供了对函数式编程的支持。这对 Java 来说是一个巨大的改进。因为这允许你编写更简洁明了，易于理解的代码。在下一章中，你会看到它们在 <em>流式编程(streams)</em> 中的应用。相信你会像我一样，喜欢上流式编程。</p><p>这些特性满足了很大一部分的、羡慕Clojure 和 Scala 这类更函数化语言的Java程序员。阻止了他们投奔向那些语言（或者至少让他们在投奔之前做好准备）。</p><p>但是，Lambdas 和方法引用远非完美，我们永远要为 Java 设计者早期的草率决定付出代价。特别是没有泛型 Lambda，所以 Lambda 在 Java 中并非一等公民。虽然我不否认 Java 8 的巨大改进，但这意味着和许多 Java 特性一样，它终究还是会让人感觉沮丧和鸡肋。</p><p>当你遇到学习困难时，请记住通过 IDE（NetBeans、IntelliJ Idea 和 Eclipse）获得帮助，因为 IDE 可以智能提示你何时使用 Lambda 表达式或方法引用，甚至有时还能为你优化代码。</p><!--下面是脚注--><p>[^2]: 例如,这个电子书是利用 <a href="http://pandoc.org/" target="_blank" rel="noopener noreferrer">Pandoc<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 制作出来的，它是用纯函数式语言 <a href="https://www.haskell.org/" target="_blank" rel="noopener noreferrer">Haskell<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 编写的一个程序 。 [^3]: 有时函数式语言将其描述为“代码即数据”。 [^4]: 这个语法来自 C++。 [^5]: 我还没有验证过这种说法。 [^6]: 当你理解了<a href="/OnJava8/book/24-Concurrent-Programming.html" class="">并发编程</a>章节的内容，你就能明白为什么更改共享变量 “不是线程安全的” 的了。 [^7]: 接口能够支持方法的原因是它们是 Java 8 默认方法，你将在下一章中了解到。 [^8]: 一些语言，如 Python，允许像调用其他函数一样调用组合函数。但这是 Java，所以我们要量力而行。 [^9]: 例如，<a href="https://immutables.github.io/" target="_blank" rel="noopener noreferrer">Immutables<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 和 <a href="https://mutabilitydetector.github.io/MutabilityDetector/" target="_blank" rel="noopener noreferrer">Mutability Detector<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><!-- 分页 --><div style="page-break-after:always;"></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/xszhu522/OnJava8/edit/main/docs/book/13-Functional-Programming.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: lingcoder@gmail.com">LingCoder</span>,<!--]--><!--[--><span class="contributor" title="email: xiangflight@foxmail.com">xiangflight</span>,<!--]--><!--[--><span class="contributor" title="email: yngwiewang@163.com">WangHengwei</span>,<!--]--><!--[--><span class="contributor" title="email: rainforest.vista@gmail.com">Yibin Yang</span>,<!--]--><!--[--><span class="contributor" title="email: 792998301@qq.com">andyphone</span>,<!--]--><!--[--><span class="contributor" title="email: jun54555@gmail.com">ChelinTsien</span>,<!--]--><!--[--><span class="contributor" title="email: 59561865+Decandy-star@users.noreply.github.com">Decandy-star</span>,<!--]--><!--[--><span class="contributor" title="email: 874898731@qq.com">Dragon Dove</span>,<!--]--><!--[--><span class="contributor" title="email: 874898731@qq.com">DragonDove</span>,<!--]--><!--[--><span class="contributor" title="email: 736777445@qq.com">Joe</span>,<!--]--><!--[--><span class="contributor" title="email: 34731641+JerryQiang@users.noreply.github.com">ZhiQiang Jiang</span>,<!--]--><!--[--><span class="contributor" title="email: 64198234+freestyle-coding@users.noreply.github.com">freestyle-coding</span>,<!--]--><!--[--><span class="contributor" title="email: 34760596+jiangqs3@users.noreply.github.com">jiangqs3</span>,<!--]--><!--[--><span class="contributor" title="email: legendyql@qq.com">legendyql</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a aria-label="第十二章 集合" class="vp-link nav-link prev nav-link prev" href="/OnJava8/book/12-Collections.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->第十二章 集合</div></a><a aria-label="第十四章 流式编程" class="vp-link nav-link next nav-link next" href="/OnJava8/book/14-Streams.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">第十四章 流式编程<!----></div></a></nav><div id="comment" class="giscus-wrapper input-top" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright © 2023 xszhu522</div></footer></div><!--]--><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/OnJava8/assets/app-f910849f.js" defer></script>
  </body>
</html>
